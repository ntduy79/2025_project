<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Draggable Image Slider</title>

    <!-- Consolidated resource loading -->
    <link th:href="@{/webjars/bootstrap/5.2.3/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <script th:src="@{/webjars/jquery/3.6.4/jquery.min.js}" defer></script>
    <script th:src="@{/webjars/bootstrap/5.2.3/js/bootstrap.bundle.min.js}" defer></script>
</head>
<body class="bg-gs">
<!-- Header Fragment -->
<div th:replace="~{fragments/header::header}"></div>

<!-- Draggable Image Slider -->
<div class="slider-container">
    <div class="slider">
        <!-- Use Thymeleaf iteration for dynamic images -->
        <img th:each="i : ${#numbers.sequence(1, 6)}"
             src="../static/images/randomCatCute.png"
             th:src="@{/images/randomCatCute.png}"
             th:alt="'Cute Cat Logo ' + ${i}">
    </div>
</div>

<!-- Optimized Slider Script -->
<script>
    (function() {
        'use strict';

        const slider = document.querySelector('.slider');
        let isDragging = false,
            startPos = 0,
            currentTranslate = 0,
            prevTranslate = 0,
            animationID = 0;

        // Touch event handlers
        const handleDragStart = (clientX) => {
            isDragging = true;
            startPos = clientX;
            animationID = requestAnimationFrame(animate);
            slider.style.cursor = 'grabbing';
        };

        const handleDragMove = (clientX) => {
            if (!isDragging) return;
            currentTranslate = prevTranslate + clientX - startPos;
        };

        const handleDragEnd = () => {
            isDragging = false;
            cancelAnimationFrame(animationID);
            prevTranslate = currentTranslate;
            slider.style.cursor = 'grab';
        };

        // Mouse events
        slider.addEventListener('mousedown', (e) => handleDragStart(e.clientX));
        slider.addEventListener('mousemove', (e) => handleDragMove(e.clientX));
        slider.addEventListener('mouseup', handleDragEnd);
        slider.addEventListener('mouseleave', handleDragEnd);

        // Touch events
        slider.addEventListener('touchstart', (e) => handleDragStart(e.touches[0].clientX));
        slider.addEventListener('touchmove', (e) => handleDragMove(e.touches[0].clientX));
        slider.addEventListener('touchend', handleDragEnd);

        function animate() {
            slider.style.transform = `translateX(${currentTranslate}px)`;
            if (isDragging) requestAnimationFrame(animate);
        }
    })();
</script>
</body>
</html>